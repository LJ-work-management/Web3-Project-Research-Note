original article: https://github.com/traderjoe-xyz/LB-Whitepaper

## Abstract
We introduce Liquidity Book (LB), a novel protocol for structuring liquidity in a decentralized exchange. The LB protocol enables the creation of unique and dynamic liquidity structures for a paired asset market. Liquidity is pooled in constant price bins which are aggregated to establish a market.

## 1 Introduction

Trader Joe (v1) was launched in 2021 as an AMM with Uniswap v2 liquidity contracts as its backbone . As DeFi advances, we have concluded that capital efficiency and liquidity flexibility are urgent issues that demand protocol development. In this paper, we present our design for the next stage of the JOE decentralized exchange.

### 1.1 Concentrated Liquidity

Tick bound liquidity, as implemented in Uniswap v3 (v3), pioneered the concept of concentrated liquidity for a general automated market maker (AMM) . In Uniswapâ€™s implementation, individual liquidity positions are established which provide reserves over a restricted price range. The reserves of each position are exchanged over its price range following a common constant function formula. This common function allows individual position reserves to be aggregated together to form the market.

Even before the concentrated liquidity term was coined, StableSwap/Curve provided a similar solution for stable exchange rate reserves. Curve v1 utilizes an invariant curve with an implied static peg . While the liquidity is unbounded, the bulk of reserves concentrate liquidity around the peg price. Curve v2 introduces a more general solution using an internal price oracle to upgrade to a dynamic peg .

Constant function algorithms used in Uniswap and Curve restrict the ability of liquidity providers to deploy tailored market making strategies. We propose a new protocol with Discretized Concentrated Liquidity to provide a flexible infrastructure layer for market participants. Discretized Concentrated Liquidity has been previously presented by the iZiSwap limit order implementation .

### 1.2 Liquidity Book

The Liquidity Book (LB) arranges liquidity of an asset pair into discrete price bins. Reserves that are deposited into a liquidity bin are available to be exchanged at the constant exchange rate (price) that is defined for the bin. The market for the asset pair is constructed by aggregating all of the discrete liquidity bins. For example, a market liquidity structure supplied by different market participants (color coded) could be represented by the figure below.

![](https://i.imgur.com/CQPjew0.png)
Figure 1: Example Liquidity Structure

## 2 Protocol Design
### 2.1 Reserve Pricing
Following AMM convention, price (P) is defined as the rate of change in Y reserves per change in X reserves. Price represents the value of the base asset (X) denominated in the quote asset (Y) terms.
$$ ğ‘ƒ = âˆ†y/âˆ†x$$

## 2.2 Bin Liquidity
Liquidity (L) is defined to be the nominal value of reserves deposited into a discrete bin and is denominated in the quote asset. Liquidity is conserved as the binâ€™s reserve composition changes and can be described in Eq 2.2 as the value sum of its composite assets.
$$ ğ‘ƒ_{j}*ğ‘¥ + ğ‘¦ = L $$
æ¯å€‹å–®ç¨çš„ bin æ˜¯ä¸€å€‹å…·æœ‰è‡ªå·±ç¨ç‰¹çš„è¯åˆæ›²ç·šçš„æ†å’Œå¸‚å ´ã€‚ bin çš„æ›²ç·šå®Œå…¨ç”± bin çš„åƒ¹æ ¼åƒæ•¸ï¼ˆéœæ…‹ï¼‰å’Œå­˜å…¥ bin çš„ç¸½æµå‹•æ€§å„²å‚™ï¼ˆå‹•æ…‹ï¼‰å®šç¾©ã€‚å¦‚åœ– 2 æ‰€ç¤ºï¼Œ y å„²å‚™æˆªè·è¡¨ç¤º bin çš„ç¸½æµå‹•æ€§ (L)ï¼Œè€Œæ–œç‡ç”± bin çš„åƒ¹æ ¼ (ğ‘ƒ ) å®šç¾©ã€‚
![](https://i.imgur.com/Vj6NCYB.png)
åœ– 2: å„²å‚™è¯åˆæ›²ç·š

### 2.3. ç®±çµ„æˆ
ç”±æ–¼ä¸Šè¿°è¨­è¨ˆï¼Œæµå‹•æ€§ç®±ä¸­çš„å„²å‚™çµ„æˆå¿…é ˆç¨ç«‹æ–¼åƒ¹æ ¼å’Œæµå‹•æ€§ã€‚å¯ä»¥ä½¿ç”¨ä¸€å€‹é™„åŠ è®Šé‡ä¾†æè¿°ç®±ä¸­å¯ç”¨çš„å„²å‚™ã€‚é€™å€‹è®Šé‡ï¼Œçµ„æˆå› å­ï¼ˆcï¼‰ï¼Œå°‡è¢«å®šç¾©ä½œç‚ºç•¶å‰ä½œç‚º Y å„²å‚™æŒæœ‰çš„ bin æµå‹•æ€§çš„ç™¾åˆ†æ¯”ã€‚çµ„æˆ (c) ä»¥ [0,1] ç‚ºç•Œã€‚
$$ câ‰¡y/L $$
(Eq: 2.3)
æ¯å€‹æµå‹•æ€§ç®±çš„è³‡ç”¢å„²å‚™å¯ä»¥ç”¨ç®±æµå‹•æ€§ L å’Œæˆåˆ† c ä¾†å……åˆ†æè¿°ï¼Œå¦‚å…¬å¼ 2.4 å’Œ 2.5 æ‰€ç¤ºã€‚
(Eq: 2.4)
$$ y=cL $$
(Eq: 2.5)
$$ x=L/P(1-c) $$

æµå‹•æ€§ç®±ä¸­ X å’Œ Y å„²å‚™çš„ç¤ºä¾‹çµ„åˆå¯ä»¥æ˜¯
å¯è¦–åŒ–ï¼Œå¦‚åœ– 3 æ‰€ç¤ºã€‚
![](https://i.imgur.com/WxV73qn.png)
åœ– 3: ç®±å„²å‚™éƒ¨ä½(P14)

### 2.4. å¸‚å ´èšåˆ
ä¸€å€‹è³‡ç”¢å°çš„å–®å€‹æµå‹•æ€§ç®±çš„èšåˆå»ºç«‹äº†è©²å°çš„å¸‚å ´ã€‚æµå‹•æ€§ç®±çš„å„²å‚™ç‹€æ…‹é è¨ˆæœƒéš¨è‘—å¸‚å ´å®šåƒ¹çš„è®ŠåŒ–åœ¨ X å„²å‚™å’Œ Y å„²å‚™ä¹‹é–“è½‰æ›ã€‚
å®šåƒ¹ä½æ–¼å¸‚å ´çš„æµå‹•æ€§ç®±å°‡åƒ…åŒ…å«è³‡ç”¢ Yï¼Œè€Œå®šåƒ¹é«˜æ–¼å¸‚å ´çš„æµå‹•æ€§ç®±å°‡åƒ…åŒ…å«è³‡ç”¢ Xã€‚
å› æ­¤ï¼Œå¸‚å ´åƒ¹æ ¼è¢«ç¢ºå®šç‚ºåŒ…å« X å„²å‚™çš„æœ€ä½åƒ¹æ ¼ç®±ã€‚

![](https://i.imgur.com/5k6HT19.png)
åœ– 4: èšåˆæµå‹•æ€§éƒ¨ä½

### 2.5. åšå¸‚
å€ŸåŠ©é›¢æ•£çš„æµå‹•æ€§ç®±ï¼Œæµå‹•æ€§æä¾›è€…èƒ½å¤ å‰µå»ºè‡ªå®šç¾©æµå‹•æ€§çµæ§‹ï¼Œä½¿ä»–å€‘èƒ½å¤ æ ¹æ“šå„è‡ªçš„ç›®æ¨™ã€é æ¸¬å’Œé¢¨éšªç‹€æ³è¼•é¬†ç®¡ç†è‡ªå·±çš„é ­å¯¸ã€‚
æµå‹•æ€§æä¾›è€…å¯ä»¥å°‡æµå‹•æ€§é›†ä¸­åœ¨æŸäº›åƒ¹æ ¼é»æˆ–é»å·®é™„è¿‘ï¼Œä¸¦èª¿æ•´å„å€‹æµå‹•æ€§ç®±ï¼Œè€Œä¸æœƒå½±éŸ¿å…¶åœ¨å…¶ä»–ç®±ä¸­çš„æµå‹•æ€§å®šä½ã€‚ç¸½é«”è€Œè¨€ï¼Œæµå‹•æ€§è³¬ç°¿è¨­è¨ˆå…è¨±å°åšå¸‚å•†æˆåŠŸé‹ä½œæ‰€éœ€çš„ç¯„åœå’Œæ·±åº¦é€²è¡Œå¾®èª¿ã€‚

## 3 å”è­°æ¶æ§‹
3.1 å¸‚å ´å®šç¾©
æ¯å€‹å¸‚å ´çš„åƒ¹æ ¼ç¯„åœéƒ½è¢«é™åˆ¶åœ¨2 çš„æ­£è²  128 æ¬¡æ–¹ä¹‹é–“
æ ¹æ“šç¨±ç‚º bin step (s) çš„é›¢æ•£åŒ–åƒæ•¸å°‡æ­¤åƒ¹æ ¼ç¯„åœé›¢æ•£åŒ–ç‚º binã€‚
ä¸€å€‹ç¨ç‰¹çš„å¸‚å ´ç”± (X, Y, s) é›†åˆå®šç¾©ã€‚
çµ¦å®šå¸‚å ´ä¸­æµå‹•æ€§ç®±çš„ç¸½æ•¸å¯ä»¥æè¿°ç‚º $$ 2*ğ‘_{ğ‘} $$ ï¼Œå…¶ä¸­ $$ N_b $$ ä½¿ç”¨å…¬å¼ 3.1 è¨ˆç®—ã€‚Nb è¡¨ç¤ºåƒ¹æ ¼å¹³åƒ¹ (par) å’Œå¸‚å ´ä¸­æœ€å¤§åƒ¹æ ¼ä¹‹é–“å¯ä»¥å­˜åœ¨çš„æœ€å¤§ç®±æ•¸çµ¦å®šçš„ bin æ­¥é©Ÿã€‚
(Eq: 3.1)
$$ ğ‘_{ğ‘} = ğ‘ğ‘Ÿğ‘”ğ‘šğ‘ğ‘¥_{i}(1 + ğ‘ )^i < 2^{128} $$

é™¤äº†åƒ¹æ ¼é™åˆ¶å¤–ï¼Œæœ€å¤§ bin æ•¸é‡é™åˆ¶ç‚ºå°æ–¼ 2^24
åœ¨å…·æœ‰æœ€å¤§ç®±æ•¸çš„å¸‚å ´ä¸­ï¼Œå°‡ä¸€åŠçš„æ½›åœ¨ç®±åˆ†é…çµ¦å°æ–¼ par çš„å€¼ï¼Œå°‡ä¸€åŠåˆ†é…çµ¦å¤§æ–¼ par çš„å€¼æœƒå°è‡´ par ç®±æ¨™è­˜ç¬¦ç‚º 2^23ï¼Œå®ƒåˆ†é…çµ¦å…¬å¼ 3.2 ä¸­çš„å¸¸æ•¸ båœ¨æ‰€æœ‰å¸‚å ´ä¸­ï¼Œå€‰ä½å°‡è¢«åˆ†é…ä¸€å€‹æ­£æ•´æ•¸æ¨™è­˜ç¬¦ (i)ï¼Œå…¶ç¯„åœåœ¨ [b - Nb, b +Nb] ä¹‹é–“ã€‚
$$ câ‰¡B^{23} $$

### 3.2 å€‰åƒ¹
ç‚ºæ¯å€‹ bin è¦å®šçš„åƒ¹æ ¼æ˜¯è©²å°çš„ bin æ­¥é•· (s) å’Œ bin çš„æ¨™è­˜ç¬¦ (i) çš„å‡½æ•¸ï¼Œå¦‚å…¬å¼ 3.2 æ‰€ç¤ºã€‚ bin æ­¥é•·åƒæ•¸ç¢ºå®šæ¯å€‹å¢é‡ bin ä¹‹é–“åƒ¹æ ¼çš„æ†å®šç™¾åˆ†æ¯”å¢åŠ æˆ–æ¸›å°‘ã€‚

(3.3) 
$$ ğ‘ƒ_ğ‘– = (1 + ğ‘ )^{ğ‘–âˆ’ğ‘} $$

### 3.3 æµå‹•æ€§è¿½è¸ª
ç‚ºäº†å„ªåŒ–æµå‹•æ€§è·Ÿè¸ªï¼Œç®±åœ¨é€šéåµŒå¥—ä¸‰å€‹ 256 ä½æ•¸çµ„å‰µå»ºçš„æ¨¹ä¸­é€²è¡Œç´¢å¼•ï¼Œå¦‚åœ– 5 æ‰€ç¤ºã€‚åœ¨é€™æ£µæ¨¹ä¸­ï¼Œæ¯å€‹ç®±éƒ½è¢«åˆ†é…ä¸€å€‹é€šéåµŒå¥—æ•¸çµ„çš„ä½ç½®è·¯å¾‘ã€‚éé›¶å€¼åˆ†é…çµ¦ä¸‰å€‹è¡¨ç¤º bin ä½ç½®çš„æ•¸çµ„å…ƒç´ ã€‚ä½¿ç”¨æ­¤æ¨¹ï¼Œå¯ä»¥åœ¨äº¤æ›æœŸé–“æœ‰æ•ˆåœ°æœç´¢å¸‚å ´çš„æµå‹•æ€§ç‹€æ…‹å’Œ/æˆ–å¾å¤–éƒ¨ç›£æ§
![](https://i.imgur.com/56yDag8.png)
åœ– 5: ç®±å­æŒ‡æ•¸æ¨¹

### 3.4 è²¿æ˜“è·¯ç·š
LB è·¯ç”±å™¨å°‡ç‚ºæ‰æœŸå’Œæµå‹•æ€§å­˜æ¬¾/å–æ¬¾æä¾›é¡å¤–çš„å®‰å…¨æ€§å’Œæ»‘é»æª¢æŸ¥ã€‚
ç•¶æ‰¾åˆ°æ›´å¥½çš„å®šåƒ¹æ™‚ï¼Œæ‰æœŸä¹Ÿå°‡é€šéå‚³çµ±çš„ AMM å°é€²è¡Œè·¯ç”±ã€‚

### 3.5 æµå‹•æ€§ä»£å¹£
å°ˆé–€ç‚º LB å”è­°é–‹ç™¼äº†ä¸€ç¨®æ–°çš„æµå‹•æ€§ä»£å¹£æ¨™æº–ï¼Œä»¥æ”¯æŒæ¯å€‹å¸‚å ´ä¸­çš„å¤§é‡ binã€‚é€šéè¨­è¨ˆï¼ŒLB å¸‚å ´ä¸­çš„æµå‹•æ€§ (L) å¯ä»¥è·¨ bin çµ„åˆï¼Œå› ç‚ºå®ƒé€šå¸¸ä»¥ Y å€¼è¨ˆå€¼ä¸¦ä¸”æ˜¯ç¨ç«‹çš„åƒåœ¾ç®±çš„ç‹€æ…‹ã€‚
å› æ­¤ï¼Œæµå‹•æ€§æ”¶æ“šä»£å¹£ LBToken å°‡æ”œå¸¶ç›¸ç­‰çš„æµå‹•æ€§å€¼ï¼Œè€Œä¸ç®¡å®ƒåŒ…å«åœ¨å“ªå€‹ bin ä¸­ã€‚æ­¤å±¬æ€§ä½¿ bin æµå‹•æ€§èƒ½å¤ è·¨ bin ç„¡ç¸«æ†ç¶åœ¨ä¸€èµ·ã€‚LBToken æœ¬è³ªä¸Šé¡ä¼¼æ–¼å‚³çµ± ERC-20 æµå‹•æ€§ä»£å¹£ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹é»é—œéµå€åˆ¥ï¼šå®ƒå€‘åœ¨é‘„é€ æ™‚è¢«åˆ†é…äº†ä¸€å€‹ id
åŒ¹é…æµå‹•æ€§æ‰€åœ¨çš„ bin æ¨™è­˜ç¬¦ (i)ã€‚
LBToken åˆç´„éµå¾ª ERC-1155 å¤šä»£å¹£æ¨™æº–ï¼Œä½†åƒ…é™æ–¼åŒ…å«å¯æ›¿ä»£çš„ ERC-20 ä»£å¹£ã€‚
LBToken æ˜¯å¯æ›¿ä»£çš„ã€ä»¥åƒ¹æ ¼ç‚ºå®šä½çš„æµå‹•æ€§æ”¶æ“šä»£å¹£ã€‚

### 3.6 å¸‚å ´åƒæ•¸
æ¯å€‹å¸‚å ´éƒ½æœƒæœ‰ä¸€çµ„åƒæ•¸ä¾†ç®¡ç†å¸‚å ´çš„è²»ç‡ï¼Œåœ¨ç¬¬ 4.3 ç¯€ä¸­é€²ä¸€æ­¥è©³ç´°èªªæ˜ã€‚åˆå§‹åƒæ•¸å€¼å°‡æ ¹æ“šç‚ºå¸‚å ´é¸æ“‡çš„ bin æ­¥åƒæ•¸åˆ†é…ã€‚
å¸‚å ´åªèƒ½é€šéåœ¨å·¥å» ä¸­å…·æœ‰ç›¸é—œè²»ç”¨åƒæ•¸çš„ bin æ­¥é©Ÿä¾†å»ºç«‹ã€‚
è²»ç”¨åƒæ•¸å¯ä»¥åœ¨åˆå§‹åŒ–å¾Œé€²è¡Œèª¿æ•´ã€‚

![](https://i.imgur.com/bFBHV3q.png)

### 3.7. é è¨€æ©Ÿ
LB å¸‚å ´å°‡æœ‰ä¸€å€‹é è¨€æ©Ÿï¼Œå°‡ä»¥ä¸‹å€¼è¨˜éŒ„åˆ°
å€å¡Šéˆï¼š
- æ™‚é–“æˆ³
- ç´¯ç©ID
- ç´¯ç©ç´¯åŠ å™¨
- ç´¯è¨ˆ Bin Crossed

ç´¯ç©å€¼å°æ–¼ç¢ºå®šéš¨æ™‚é–“è®ŠåŒ–çš„è®ŠåŒ–å¾ˆæœ‰ç”¨ã€‚é è¨€æ©Ÿæä¾›å¸‚å ´åƒ¹æ ¼å’Œæ³¢å‹•ç‡/è²»ç”¨æŒ‡æ¨™ï¼Œå› ç‚ºå®ƒæ˜¯ç®—æ³•äº¤æ˜“å’Œæµå‹•æ€§æä¾›çš„æœ‰ç”¨ä¿¡æ¯ã€‚
sampleLifetime è¨­ç½®ï¼ˆæ¡æ¨£ç‡ï¼‰æ˜¯å¸‚å ´å‰µå»ºæ™‚å®šç¾©çš„å¸‚å ´åƒæ•¸ï¼Œç”¨æˆ¶å¯ä»¥æ ¹æ“šéœ€è¦å¢åŠ  Oracle æ¨£æœ¬é‡ã€‚

## 4 ç”¨æˆ¶äº¤äº’
### 4.1 æ·»åŠ /åˆªé™¤æµå‹•æ€§
å‘æ´»èºæµå‹•æ€§ç®±æ·»åŠ å’Œç§»é™¤æµå‹•æ€§å°‡ä¿å­˜åƒ¹æ ¼ (P) å’Œæˆåˆ† (c)ã€‚å°æ–¼çµ¦å®šçš„æµå‹•æ€§èª¿æ•´ï¼Œæ‰€éœ€çš„å„²å‚™ X å’Œå„²å‚™ Y å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å…¬å¼ 4.1 å’Œ 4.2 è¨ˆç®—ã€‚
(4.1)
$$âˆ†ğ¿ =ğ‘ƒ/(1âˆ’ğ‘)*âˆ†x$$
(4.2) 
$$ âˆ†ğ¿ = 1/ğ‘*âˆ†y$$

å°æ–¼æ‰€æœ‰â€œæœªå•Ÿå‹•â€(ä¸åœ¨åƒ¹æ ¼ä¸Š)çš„æµå‹•æ€§ç®±ï¼Œæµå‹•æ€§å¯ä»¥å°ˆé–€æ·»åŠ åˆ°å„²å‚™ X æˆ–å„²å‚™ Y ä¸­ï¼Œå…·é«”å–æ±ºæ–¼çµ„åˆé‚Šç•Œã€‚

(4.3)
$$ âˆ†ğ¿_{ğ‘=0} = ğ‘ƒ*âˆ†x $$


(4.4)
$$ âˆ†ğ¿_{ğ‘=1} = âˆ†y $$

å¦‚æœæ¯”ä¾‹ä¸ç­‰æ–¼ bin çš„çµ„æˆï¼Œæ·»åŠ åˆ°æ´»å‹• bin çš„æµå‹•æ€§å°‡è‡ªå‹•åœ¨å„²å‚™ä¹‹é–“é€²è¡Œäº¤æ›ï¼Œä¸¦ä¸”äº¤æ›çš„æ•¸é‡å°‡ç”¢ç”Ÿäº¤æ›è²»ç”¨ã€‚
å°‡æµå‹•æ€§æ·»åŠ åˆ°èˆ‡ bin çš„çµ„æˆä¸ä¸€è‡´çš„â€œæœªå•Ÿå‹•â€ bin çš„äº¤æ˜“å°‡å¤±æ•—ã€‚

### 4.2 Swap
åœ¨æµå‹•æ€§ç®±å…§äº¤æ›å„²å‚™å°‡ä¿å­˜æµå‹•æ€§å’Œåƒ¹æ ¼ï¼Œå› æ­¤åªæœ‰å„²å‚™çµ„æˆæœƒæ”¹è®Šã€‚å„²å‚™æŒ‰ç…§å…¬å¼ 4.5 é€²è¡Œäº¤æ›ï¼Œè€Œçµ„æˆä¿æŒåœ¨ [0,1] çš„ç¯„åœå…§ã€‚
(4.5) 
$$ Î”ğ‘¦ = âˆ’ ğ‘ƒÎ”ğ‘¥ $$

åœ¨é”åˆ°çµ„åˆç•Œé™ä¹‹å‰ï¼Œæµå‹•æ€§ç®±ä¸­å¯ç”¨çš„å„²å‚™å¯ä»¥æ ¹æ“šå…¬å¼ 4.6 å’Œ 4.7 è¨ˆç®—ã€‚
(4.6)
$$ Î”ğ‘ =âˆ’ğ‘ƒ/ğ¿*Î”ğ‘¥
$$
(4.7) 
$$ Î”ğ‘ =1/ğ¿*Î”ğ‘¦ $$
ç•¶æ‰æœŸéœ€è¦çš„æµå‹•æ€§æ¯”ç•¶å‰ bin ä¸­å¯ç”¨çš„æ›´å¤šæ™‚ï¼Œæ‰æœŸå°‡è€—ç›¡æ¯å€‹é€£çºŒ bin ä¸­çš„æµå‹•æ€§ï¼Œç„¶å¾Œå†è½‰ç§»åˆ°ä¸‹ä¸€å€‹å…·æœ‰æµå‹•æ€§çš„ç›¸é„° binã€‚

### 4.3 Swap è²»ç”¨
å”è­°å°‡æ”¶å–è²»ç”¨ï¼Œä»¥è£œå„Ÿæµå‹•æ€§æä¾›è€…ç™¼ç”Ÿçš„äº¤æ˜“æ´»å‹•ã€‚ç¸½æ‰æœŸè²»ç”¨ (fs) å°‡åŒ…å«å…©å€‹éƒ¨åˆ†ï¼Œä¸€å€‹åŸºæœ¬è²»ç”¨ (fb) å’Œä¸€å€‹å¯è®Šè²»ç”¨ (fv)ï¼Œå®ƒæ˜¯ç¬æ™‚åƒ¹æ ¼çš„å‡½æ•¸æ®ç™¼æ€§ã€‚
è²»ç‡å°‡æ‡‰ç”¨æ–¼æ¯å€‹æµå‹•æ€§ç®±ä¸­çš„æ‰æœŸé‡‘é¡ï¼Œä¸¦åœ¨åˆ†é…çµ¦å”è­°å¾ŒæŒ‰æ¯”ä¾‹åˆ†é…çµ¦è©²ç®±ä¸­çš„æµå‹•æ€§æä¾›è€…ã€‚
è²»ç”¨å°‡èˆ‡æµå‹•æ€§åˆ†é–‹ä¸¦ç”±æµå‹•æ€§æä¾›è€…ç´¢å–ã€‚
å¯ä»¥æ ¹æ“šå…¬å¼ 4.8 è¨ˆç®—è·¨ n å€‹ bin çš„æ‰æœŸç¸½è²»ç”¨ã€‚
![](https://i.imgur.com/P53hpt5.png)
#### 4.3.1 åŸºæœ¬è²»ç”¨
åŸºæœ¬è²»ç‡ (fb) æ˜¯ bin æ­¥é•· (s) çš„å‡½æ•¸ï¼Œä¸¦æŒ‰åŸºæœ¬è²»ç‡ (B) ç¸®æ”¾ï¼Œå¦‚å…¬å¼ 4.9 æ‰€ç¤ºã€‚
åŸºæœ¬è²»ç”¨ä»£è¡¨æ‰€æœ‰æ‰æœŸçš„æœ€ä½è²»ç‡ï¼Œæœ€å¤§å€¼ç­‰æ–¼ bin æ­¥é•·ã€‚
(4.9) 
$$ f_b = B*s $$

4.3.2 å¯è®Šè²»ç”¨
å¯è®Šè²»ç”¨ (fv) æ—¨åœ¨è£œå„Ÿæµå‹•æ€§æä¾›è€…çš„ç¬æ™‚æ³¢å‹•æ€§ï¼Œä¸¦æ¿€å‹µæµå‹•æ€§æä¾›è€…åœç¹ç§»å‹•åƒ¹æ ¼ç©æ¥µç®¡ç†æµå‹•æ€§ã€‚å¯è®Šè²»ç”¨ä½¿ç”¨å…¬å¼ 4.10 è¨ˆç®—æ¯ç®± (k)ã€‚

![](https://i.imgur.com/6l8oBPk.png)

ç¬æ™‚æ³¢å‹•ç‡åœ¨æ–°å¼•å…¥çš„æ³¢å‹•ç‡ç´¯ç©è®Šé‡ vk ä¸­è¢«æ•ç²ã€‚A æ˜¯ç”¨æ–¼è¡¡é‡å¯è®Šè²»ç”¨éƒ¨åˆ†çš„å¸‚å ´åƒæ•¸ã€‚

#### 4.3.3 æ³¢å‹•ç‡ç´¯åŠ å™¨
æ³¢å‹•æ€§å¯ä»¥å¾ bin éš¨æ™‚é–“è®ŠåŒ–çš„æ•¸é‡å¾—å‡ºã€‚
æ¯å€‹ bin è®ŠåŒ–ä»£è¡¨ä¸€å€‹ç”± bin æ­¥é©Ÿå®šç¾©çš„å›ºå®šåƒ¹æ ¼è®Šå‹•ã€‚éœ€è¦ä¸€å€‹ç´¯åŠ å™¨ä¾†å°‡ bin äº¤å‰çš„æ‡‰ç”¨æ“´å±•ç‚ºè¶…è¶Šå–®å€‹äº¤æ˜“çš„æ³¢å‹•æ€§åº¦é‡ã€‚
æ³¢å‹•ç‡ç´¯åŠ å™¨ (vk) æ˜¯å–®å€‹äº¤æ˜“ä¸­çš„ bin äº¤å‰åŠå…¶åœ¨å…ˆå‰äº¤æ˜“ä¸­çš„å€¼çš„å‡½æ•¸ï¼Œå¦‚å…¬å¼ 4.11 æ‰€ç¤ºã€‚

![](https://i.imgur.com/MBomjGl.png)

ç´¯åŠ å™¨è¡¨ç¤ºåœ¨ä¸€çµ„å…ˆå‰äº‹å‹™ä¸­ç™¼ç”Ÿçš„ bin æ›´æ”¹çš„æ•¸é‡ã€‚ç•¶é€£çºŒäº‹å‹™ç™¼ç”Ÿåœ¨æ™‚é–“ä¸Šé™å’Œä¸‹é™ä¹‹é–“æ™‚ï¼Œç´¯åŠ å™¨å°‡æŒ‰æ¸›å°‘å› å­ R è¡°æ¸›ã€‚
ç•¶äº¤æ˜“é »ç‡é«˜æ™‚ï¼ˆç”± filterPeriod, tl å»ºç«‹ï¼‰ï¼Œå¸‚å ´è¢«èªç‚ºæ˜¯æ³¢å‹•çš„ï¼Œç´¯åŠ å™¨ä¸æœƒè¡°æ¸›ã€‚ç•¶äº¤æ˜“é »ç‡ä½ï¼ˆç”± decayPeriod, tu å»ºç«‹ï¼‰æ™‚ï¼Œå¸‚å ´è¢«èªç‚ºæ˜¯ç©©å®šçš„ä¸¦ä¸”ç´¯åŠ å™¨å°‡é‡ç½®ç‚º 0ã€‚
ç‚ºäº†é˜²æ­¢éåº¦å’ŒæŒçºŒçš„è²»ç”¨ï¼Œæ¯å€‹å¸‚å ´éƒ½æœƒä½¿ç”¨ maxAccumulator åƒæ•¸ ğ‘£ ä¾†é™åˆ¶ç´¯åŠ å™¨çš„æœ€å¤§å€¼ã€‚
#### 4.3.4 å”è­°è²»ç”¨
ç‚ºå”è­°ä¿ç•™çš„æ‰æœŸè²»ç”¨éƒ¨åˆ† (fp) å°‡ç”±å”è­°è²»ç”¨åƒæ•¸ (ğœ™) æ§åˆ¶ã€‚ğœ™ æ˜¯ä¸€å€‹å¸‚å ´åƒæ•¸ï¼Œå°‡ç®¡ç†æ¯å€‹å¸‚å ´çš„è²»ç”¨åˆ†é…ã€‚æ”¶å–å”è­°è²»ç”¨å¾Œï¼Œå‰©é¤˜éƒ¨åˆ†å°‡æ˜¯ç™¼é€çµ¦æµå‹•æ€§æä¾›è€…ã€‚
![](https://i.imgur.com/mUXrITy.png)

## 5 DEX æ”¹é€²
### 5.1 ç„¡å¸¸æå¤±
å¯è®Šè²»ç”¨ç‚ºæµå‹•æ€§æä¾›è€…åœ¨å„ç¨®äº¤æ˜“å‹•æ…‹ä¸‹ç®¡ç†ç„¡å¸¸æå¤±æä¾›è£œå„Ÿã€‚
é‘‘æ–¼åƒ¹æ ¼æ³¢å‹•æœƒå°è‡´ç„¡å¸¸æå¤±ï¼Œæ³¢å‹•ç´¯åŠ å™¨æ˜¯ä¸€ç¨®æ ¹æ“šå¸‚å ´å‹•æ…‹èª¿æ•´è²»ç”¨çš„è‡ªç„¶æ©Ÿåˆ¶ã€‚
æ­¤å¤–ï¼Œç”±æ–¼æ³¢å‹•ç‡ç´¯åŠ å™¨çš„æ™‚é–“è¡°æ¸›ï¼Œæµå‹•æ€§æä¾›è€…æœ‰æ©Ÿæœƒè¶…è¶Šé€™ä¸€é æœŸæ”¶ç›Šã€‚
é€™ç¨®å›å ±å¦‚åœ– 6 æ‰€ç¤ºã€‚ç”±æ–¼ç´¯åŠ å™¨åŸºæ–¼ bin æ­¥é•·ï¼Œå› æ­¤åœ¨æ¥µä¸ç©©å®šçš„äº‹ä»¶ä¸‹ç”±æ–¼åç¾©åƒ¹æ ¼è®ŠåŒ–çš„å¤§åå·®è€Œç™¼ç”Ÿè·Ÿè¸ªéŒ¯èª¤ã€‚

![](https://i.imgur.com/wJrP2WE.png)

### 5.2 æµå‹•æ€§æ·±åº¦
æé«˜äº¤æ˜“æ‰€çš„è³‡æœ¬æ•ˆç‡æœƒå¢åŠ ä¸€å®šæ•¸é‡è³‡æœ¬çš„å¸‚å ´æ·±åº¦ã€‚
è³‡æœ¬æ•ˆç‡å¯ä»¥å®šç¾©ç‚ºæä¾›ç›¸ç•¶æ–¼ v1 çš„æµå‹•æ€§æ‰€éœ€çš„è³‡æœ¬æ¸›å°‘ã€‚
å°æ–¼ LBï¼Œé€šéå°‡ v1 ä¸Šçš„æ‰æœŸå°åƒ¹æ ¼çš„å½±éŸ¿ç­‰åŒæ–¼å–®å€‹ bin æ­¥é©Ÿï¼Œå¯ä»¥æ‰¾åˆ°å¯æ¯”è¼ƒçš„æµå‹•æ€§ã€‚
ç”±è©²å®šç¾©å¾—å‡ºçš„æ•ˆç‡æ–¹ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼Œæ•ˆç‡æ¥µé™çµæœåˆ—æ–¼åœ– 7 ä¸­ã€‚
é€™äº›é™åˆ¶ä»£è¡¨äº†çµ¦å®š bin æ­¥é•·çš„æ¯å€‹å¸‚å ´çš„æœ€å¤§æ•ˆç‡ã€‚

![](https://i.imgur.com/1V6iVhY.png)

å¦‚åœ– 7 æ‰€ç¤ºï¼ŒLB çš„æ•ˆç‡èˆ‡ Uniswap v3 (v3) ç›¸ç•¶ã€‚
å¯ä»¥ä½¿ç”¨å‡å‹»åˆ†ä½ˆçš„ LB ä½ç½®ä¾†é€¼è¿‘ v3 ä½ç½®ã€‚
å¦‚æœæµå‹•æ€§è¦åœ¨ X ä»£å¹£çš„å€‰ä¸­å¹³å‡åˆ†é…ï¼Œå‰‡ LB å’Œ v3 ä¹‹é–“çš„æ‰æœŸåƒ¹å€¼åœ¨å€‰ä½ä¸Šçš„ç›¸å°å·®ç•°ç”±æ–¹ç¨‹ 5.2 æè¿°ã€‚é€™å€‹æ–¹ç¨‹å¯ä»¥ç¹ªè£½ç‚ºä¸€çµ„å…·æœ‰ä¸åŒåƒ¹æ ¼ç¯„åœçš„å€‰ä½ï¼Œé›¢æ•£åŒ–ç‚ºä¸åŒçš„bin æ­¥é©Ÿï¼Œå¦‚åœ– 8 æ‰€ç¤ºã€‚

![](https://i.imgur.com/E7nEavq.png)
![](https://i.imgur.com/w5tYKTs.png)
auto_awesome
Translate from: English
1,150 / 5,000
Translation results
å¦‚åœ– 8 æ‰€ç¤ºï¼Œé ­å¯¸åƒ¹æ ¼ç¯„åœæ˜¯ç›¸å°å¸‚å ´æ·±åº¦çš„é‡è¦å› ç´ ï¼Œè€Œä¸æ˜¯å€‰çµæ§‹ã€‚äº‹å¯¦ä¸Šï¼Œå°æ–¼è·¨è¶Šè‡³å°‘ 2 å€‹å€‰çš„å€‰ä½ï¼Œè·¨æ­¥é¸æ“‡çš„æ·±åº¦å·®ç•°å¯ä»¥å¿½ç•¥ä¸è¨ˆã€‚
ä½¿ç”¨ä¸Šé¢æŒ‡å®šçš„åˆ†ä½ˆï¼ŒLB çš„å¸‚å ´æ·±åº¦åœ¨ Uniswap v3 çš„ 1% ä»¥å…§ï¼Œå°æ–¼ä»»ä½•è·¨åº¦ä½æ–¼ 60% åƒ¹æ ¼ç¯„åœçš„é ­å¯¸ã€‚æ­¤å¤–ï¼Œæ·±åº¦å·®ç•°å¹¾ä¹å®Œå…¨æ˜¯ç”±æ–¼è·¨ç¯„åœå…§æµå‹•æ€§åˆ†ä½ˆçš„é¸æ“‡ï¼ˆèˆ‡ v3 çš„å¹¾ä½•åºåˆ—ç›¸æ¯”ï¼‰ä¸¦ä¸”åƒ…åœ¨å¤§ç¯„åœä½ç½®ä¸Šæ‰æœ‰æ„ç¾©ã€‚
é€™äº›ç™¼ç¾åƒ…é€²ä¸€æ­¥èªªæ˜äº† LB å”è­°å¯¦ç¾çš„éˆæ´»æµå‹•æ€§åˆ†é…çš„åƒ¹å€¼ã€‚
## 6 çµè«–
æµå‹•æ€§è³¬ç°¿ (LB) æ˜¯ä¸€ç¨®ç”¨æ–¼æ§‹å»ºå»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€æµå‹•æ€§çš„æ–°ç©è¨­è¨ˆã€‚å®ƒå…è¨±å°‡æµå‹•æ€§é›¢æ•£åˆ°å›ºå®šåƒ¹æ ¼ç®±ä¸­ï¼Œæ”¹å–„æ»‘é»å’Œæ‰æœŸå®šåƒ¹ã€‚èˆ‡ä»¥å‰çš„é›†ä¸­æµå‹•æ€§å”è­°ä¸åŒï¼ŒLB é¿å…äº†æµå‹•æ€§æä¾›è€…çš„é«˜ç„¡å¸¸æå¤±ã€‚ LB æµå‹•æ€§çµæ§‹å…è¨±é€²ä¸€æ­¥çš„å¯çµ„åˆæ€§ï¼Œæˆ‘å€‘ç†±è¡·æ–¼èˆ‡ DeFi ç¤¾å€ä¸€èµ·æ¢ç´¢æ–°çš„ç”¨ä¾‹ã€‚